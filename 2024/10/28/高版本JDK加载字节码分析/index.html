<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="高版本JDK加载字节码分析这是一段很典型的动态加载字节码操作，在jdk8中，可以执行任意代码。 123456789101112131415import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;import java.util.Base64;public class evilByteCla">
<meta property="og:type" content="article">
<meta property="og:title" content="高版本JDK加载字节码分析">
<meta property="og:url" content="http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="cmisl_破站">
<meta property="og:description" content="高版本JDK加载字节码分析这是一段很典型的动态加载字节码操作，在jdk8中，可以执行任意代码。 123456789101112131415import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;import java.util.Base64;public class evilByteCla">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20241026173730868.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20241028025725610.png">
<meta property="article:published_time" content="2024-10-27T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-17T17:36:10.384Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20241026173730868.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>高版本JDK加载字节码分析</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/11/07/Shiro%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/09/25/ASM%E5%AD%97%E8%8A%82%E7%A0%81%E7%BC%96%E8%BE%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&text=高版本JDK加载字节码分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&is_video=false&description=高版本JDK加载字节码分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=高版本JDK加载字节码分析&body=Check out this article: http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&name=高版本JDK加载字节码分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&t=高版本JDK加载字节码分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">高版本JDK加载字节码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JDK9%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">JDK9的模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">影响</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDK17%E7%9A%84%E5%BC%BA%E5%B0%81%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">JDK17的强封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsafe%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">Unsafe类</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        高版本JDK加载字节码分析
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">cmisl</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-10-27T16:00:00.000Z" class="dt-published" itemprop="datePublished">2024-10-28</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="高版本JDK加载字节码分析"><a href="#高版本JDK加载字节码分析" class="headerlink" title="高版本JDK加载字节码分析"></a>高版本JDK加载字节码分析</h1><p>这是一段很典型的动态加载字节码操作，在jdk8中，可以执行任意代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evilByteClassloader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException &#123;</span><br><span class="line">        String evilClassBase64=<span class="string">&quot;Base64 encoding of malicious bytecode&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] decode = Base64.getDecoder().decode(evilClassBase64);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">defineClass</span> <span class="operator">=</span>ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line">        defineClass.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">evilClassloader</span> <span class="operator">=</span> (Class) defineClass.invoke(ClassLoader.getSystemClassLoader(), decode, <span class="number">0</span>, decode.length);</span><br><span class="line">        evilClassloader.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20241026173730868.png" alt="image-20241026173730868"></p>
<p>不过，随着java版本的更新，这种方法被限制。</p>
<h2 id="JDK9的模块化"><a href="#JDK9的模块化" class="headerlink" title="JDK9的模块化"></a>JDK9的模块化</h2><p>Oracle官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/whatsnew/toc.htm#JSNEW-GUID-C23AFD78-C777-460B-8ACE-58BE5EA681F6">Java Platform, Standard Edition What’s New in Oracle JDK 9, Release 9</a></p>
<p>Java 9 引入了模块化系统（Project Jigsaw）。模块化的主要目的是提高 Java 的可维护性、可扩展性和安全性，同时改善大型应用程序和库的构建和管理。</p>
<ul>
<li><strong>模块</strong>：模块是一个具有明确边界的代码单元，它包含了一组相关的包、类和资源。每个模块都有一个描述文件（<code>module-info.java</code>），用于声明模块的名称、依赖关系以及导出的包。</li>
</ul>
<p>在 Java 9 中，每个模块都用一个 <code>module-info.java</code> 文件来定义。这个文件位于模块的根目录下，包含了该模块的元数据。以下是一个示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.myModule &#123;</span><br><span class="line">    <span class="keyword">exports</span> com.example.myModule.api; <span class="comment">// 导出公共 API</span></span><br><span class="line">    <span class="keyword">requires</span> java.sql; <span class="comment">// 声明依赖于 java.sql 模块</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java 9 还将 JDK 本身进行了模块化</p>
<ul>
<li><code>java.base</code>：核心 Java 类库，所有模块都依赖于这个模块。</li>
<li><code>java.sql</code>：与数据库连接相关的模块。</li>
<li><code>java.xml</code>：与 XML 处理相关的模块。</li>
</ul>
<p>模块化可以比作建造一座房子，将其分成多个功能明确的房间。每个房间（模块）负责特定的任务，如客厅用于接待、厨房用于做饭等，这样使得整个房子（软件项目）结构清晰、易于理解和维护。模块之间互不干扰，减少了功能冲突，允许独立开发和测试，提升了开发效率。此外，模块化还可以按需加载，节省资源，并使得维护工作变得更加简单，只需修复出现问题的模块，而不影响其他部分。</p>
<h3 id="影响"><a href="#影响" class="headerlink" title="影响"></a>影响</h3><p>那么其实这次更新，其实并没有对上面代码造成什么影响，我们仍然可以动态加载字节码，只是会代码执行时会输出警告信息，提示你正在进行非法反射访问。这并不会阻止代码执行，但会提醒你这种做法在未来可能会被禁止。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WARNING: An illegal reflective access operation has occurred</span><br><span class="line">WARNING: Illegal reflective access by EvilClassLoader.evilByteClassloader (file:/D:/java_local/Temp/target/classes/) to method java.lang.ClassLoader.defineClass(<span class="type">byte</span>[],<span class="type">int</span>,<span class="type">int</span>)</span><br><span class="line">WARNING: Please consider reporting <span class="built_in">this</span> to the maintainers of EvilClassLoader.evilByteClassloader</span><br><span class="line">WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations</span><br><span class="line">WARNING: All illegal access operations will be denied in a future release</span><br></pre></td></tr></table></figure>

<h2 id="JDK17的强封装"><a href="#JDK17的强封装" class="headerlink" title="JDK17的强封装"></a>JDK17的强封装</h2><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/17/migrate/migrating-jdk-8-later-jdk-releases.html#GUID-7BB28E4D-99B3-4078-BDC4-FC24180CE82B">Migrating From JDK 8 to Later JDK Releases</a></p>
<blockquote>
<p>Some tools and libraries use reflection to access parts of the JDK that are meant for internal use only. This use of reflection negatively impacts the security and maintainability of the JDK. To aid migration, JDK 9 through JDK 16 allowed this reflection to continue, but emitted warnings about <em>illegal reflective access</em>. However, JDK 17 is <em>strongly encapsulated</em>, so this reflection is no longer permitted by default. </p>
</blockquote>
<p>根据<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/17/migrate/migrating-jdk-8-later-jdk-releases.html#GUID-7BB28E4D-99B3-4078-BDC4-FC24180CE82B">Oracle的文档</a>，为了安全性，从JDK 17开始对java本身代码使用强封装，原文叫Strong Encapsulation。任何对java.*代码中的非public变量和方法进行反射会抛出InaccessibleObjectException异常。</p>
<p><a target="_blank" rel="noopener" href="https://openjdk.org/jeps/403">JDK的文档</a>解释了对java api进行封装的两个理由：</p>
<ol>
<li>对java代码进行反射是不安全的，比如可以调用ClassLoader的defineClass方法，这样在运行时候可以给程序注入任意代码。</li>
<li>java的这些非公开的api本身就是非标准的，让开发者依赖使用这个api会给JDK的维护带来负担。</li>
</ol>
<p>所以从JDK 9开始就准备限制对java api的反射进行限制，直到JDK 17才正式禁用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.reflect.InaccessibleObjectException: Unable to make <span class="keyword">protected</span> <span class="keyword">final</span> java.lang.Class java.lang.ClassLoader.defineClass(<span class="type">byte</span>[],<span class="type">int</span>,<span class="type">int</span>) <span class="keyword">throws</span> java.lang.ClassFormatError accessible: <span class="keyword">module</span> java.base does not <span class="string">&quot;opens java.lang&quot;</span> to unnamed <span class="keyword">module</span> @404b9385</span><br><span class="line">	at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:<span class="number">354</span>)</span><br><span class="line">	at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:<span class="number">297</span>)</span><br><span class="line">	at java.base/java.lang.reflect.Method.checkCanSetAccessible(Method.java:<span class="number">199</span>)</span><br><span class="line">	at java.base/java.lang.reflect.Method.setAccessible(Method.java:<span class="number">193</span>)</span><br><span class="line">	at EvilClassLoader.evilByteClassloader.main(evilByteClassloader.java:<span class="number">13</span>)</span><br></pre></td></tr></table></figure>

<p>这段信息说明：</p>
<ul>
<li><code>defineClass</code> 方法被声明为 <code>protected</code>，并且它属于 <code>java.base</code> 模块。</li>
<li><code>java.base</code> 模块没有将 <code>java.lang</code> 包开放给未命名的模块（即没有明确声明的模块）。</li>
</ul>
<p>可以打开java.base模块的moudle-info.class文件看看就知道了，没有使用opens指令，也就是说并没有开放资源给外部模块反射访问。</p>
<p>下面是部分关键字的解释：</p>
<ol>
<li><code>module</code></li>
</ol>
<ul>
<li><strong>定义</strong>：用于声明一个模块。每个模块都有一个唯一的名称。</li>
<li><strong>示例</strong>：</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.myModule &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>requires</code></li>
</ol>
<ul>
<li><strong>定义</strong>：用来声明当前模块所依赖的其他模块。一个模块可以依赖于一个或多个模块。</li>
<li><strong>示例</strong>：</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.myModule &#123;</span><br><span class="line">    <span class="keyword">requires</span> com.example.otherModule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>exports</code></li>
</ol>
<ul>
<li><strong>定义</strong>：用来声明当前模块希望公开的包。通过 <code>exports</code> 声明的包中的公共类和接口可以被其他模块访问。</li>
<li><strong>示例</strong>：</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.myModule &#123;</span><br><span class="line">    <span class="keyword">exports</span> com.example.myModule.api;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>opens</code></li>
</ol>
<ul>
<li><strong>定义</strong>：与 <code>exports</code> 类似，但允许其他模块通过反射访问指定的包。适用于需要动态访问类和成员的情况，如序列化和依赖注入。</li>
<li><strong>示例</strong>：</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> com.example.myModule &#123;</span><br><span class="line">    opens com.example.myModule.internal to com.example.otherModule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而我们动态类加载调用的是反射调用java.lang.ClassLoader#defineClass，为java.lang.*位于java.base模块下，而这个模块不允许外部模块反射调用，因此上面代码无法成功动态加载字节码。</p>
<h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><p>当然，我们任然可以绕过上述限制。</p>
<p>根据报错信息，我们可以很容易追踪到问题出现在如下函数中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkCanSetAccessible</span><span class="params">(Class&lt;?&gt; caller,</span></span><br><span class="line"><span class="params">                                      Class&lt;?&gt; declaringClass,</span></span><br><span class="line"><span class="params">                                      <span class="type">boolean</span> throwExceptionIfDenied)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (caller == MethodHandle.class) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalCallerException</span>();   <span class="comment">// should not happen</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Module</span> <span class="variable">callerModule</span> <span class="operator">=</span> caller.getModule();</span><br><span class="line">    <span class="type">Module</span> <span class="variable">declaringModule</span> <span class="operator">=</span> declaringClass.getModule();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callerModule == declaringModule) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (callerModule == Object.class.getModule()) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!declaringModule.isNamed()) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">pn</span> <span class="operator">=</span> declaringClass.getPackageName();</span><br><span class="line">    <span class="type">int</span> modifiers;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> <span class="keyword">instanceof</span> Executable) &#123;</span><br><span class="line">        modifiers = ((Executable) <span class="built_in">this</span>).getModifiers();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        modifiers = ((Field) <span class="built_in">this</span>).getModifiers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// class is public and package is exported to caller</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isClassPublic</span> <span class="operator">=</span> Modifier.isPublic(declaringClass.getModifiers());</span><br><span class="line">    <span class="keyword">if</span> (isClassPublic &amp;&amp; declaringModule.isExported(pn, callerModule)) &#123;</span><br><span class="line">        <span class="comment">// member is public</span></span><br><span class="line">        <span class="keyword">if</span> (Modifier.isPublic(modifiers)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// member is protected-static</span></span><br><span class="line">        <span class="keyword">if</span> (Modifier.isProtected(modifiers)</span><br><span class="line">            &amp;&amp; Modifier.isStatic(modifiers)</span><br><span class="line">            &amp;&amp; isSubclassOf(caller, declaringClass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// package is open to caller</span></span><br><span class="line">    <span class="keyword">if</span> (declaringModule.isOpen(pn, callerModule)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (throwExceptionIfDenied) &#123;</span><br><span class="line">        <span class="comment">// not accessible</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Unable to make &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> <span class="keyword">instanceof</span> Field)</span><br><span class="line">            msg += <span class="string">&quot;field &quot;</span>;</span><br><span class="line">        msg += <span class="built_in">this</span> + <span class="string">&quot; accessible: &quot;</span> + declaringModule + <span class="string">&quot; does not \&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (isClassPublic &amp;&amp; Modifier.isPublic(modifiers))</span><br><span class="line">            msg += <span class="string">&quot;exports&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            msg += <span class="string">&quot;opens&quot;</span>;</span><br><span class="line">        msg += <span class="string">&quot; &quot;</span> + pn + <span class="string">&quot;\&quot; to &quot;</span> + callerModule;</span><br><span class="line">        <span class="type">InaccessibleObjectException</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InaccessibleObjectException</span>(msg);</span><br><span class="line">        <span class="keyword">if</span> (printStackTraceWhenAccessFails()) &#123;</span><br><span class="line">            e.printStackTrace(System.err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码是 Java 中反射机制的一部分，主要用于检查一个类或成员（如方法、字段）是否可以通过反射访问。它的功能是决定一个调用者（<code>caller</code>）是否有权限访问某个声明者的类或成员（<code>declaringClass</code>）。</p>
<p>在这段代码中，<code>checkCanSetAccessible</code> 方法有多个条件可以返回 <code>true</code>，表示调用者可以访问指定的类或成员。以下是所有能返回 <code>true</code> 的情况的总结：</p>
<ol>
<li><strong>同一模块</strong>：如果 <code>callerModule</code> 和 <code>declaringModule</code> 是同一个模块（<code>callerModule == declaringModule</code>），返回 <code>true</code>。</li>
<li><strong>未命名模块</strong>：如果 <code>callerModule</code> 是 <code>Object</code> 类所在的模块（未命名模块），返回 <code>true</code>（<code>callerModule == Object.class.getModule()</code>）。</li>
<li><strong>未命名模块的声明者</strong>：如果 <code>declaringModule</code> 不是命名模块（<code>!declaringModule.isNamed()</code>），返回 <code>true</code>。</li>
<li><strong>公共类和导出的包</strong>：如果 <code>declaringClass</code> 是公共类（<code>isClassPublic</code> 为 <code>true</code>）并且其声明者模块导出了包（<code>declaringModule.isExported(pn, callerModule)</code>）：若成员是公共的（<code>Modifier.isPublic(modifiers)</code>），返回 <code>true</code>。或者若成员是受保护的静态成员（<code>Modifier.isProtected(modifiers) &amp;&amp; Modifier.isStatic(modifiers)</code>）且调用者是声明者类的子类（<code>isSubclassOf(caller, declaringClass)</code>），返回 <code>true</code>。</li>
<li><strong>开放的包</strong>：如果 <code>declaringModule</code> 对包（<code>pn</code>）是开放的（<code>declaringModule.isOpen(pn, callerModule)</code>），返回 <code>true</code>。</li>
</ol>
<p>我们可以关注第一种情况，也就是<code>callerModule</code> 和 <code>declaringModule</code> 是同一个模块这种情况。因为他的比较是获取调用类的<code>Class</code>对象的<code>Moudle</code>属性去和声明类的<code>Class</code>对象的<code>module</code>属性去做一个比较，即我们正在运行的当前类和<code>ClassLoader</code>类的<code>Class</code>对象的<code>module</code>属性做比较，如果我们可以修改当前类的<code>Class</code>对象的<code>module</code>属性，将其设置和<code>ClassLoader</code>类的<code>Class</code>对象的<code>module</code>属性一样，那就可以返回<code>true</code>，即运行当前类反射调用<code>ClassLoader</code>类的<code>defineclass</code>方法。</p>
<p>那么如何做到了，先别急，我们需要引入一个类，因为上面的操作将基于这个类的方法来实现。</p>
<h2 id="Unsafe类"><a href="#Unsafe类" class="headerlink" title="Unsafe类"></a>Unsafe类</h2><p><code>Unsafe</code> 是位于 <code>sun.misc</code> 包下的一个类，主要提供一些用于执行低级别、不安全操作的方法，如直接访问系统内存资源、自主管理内存资源等，这些方法在提升 Java 运行效率、增强 Java 语言底层资源操作能力方面起到了很大的作用。但由于 <code>Unsafe</code> 类使 Java 语言拥有了类似 C 语言指针一样操作内存空间的能力，这无疑也增加了程序发生相关指针问题的风险。在程序中过度、不正确使用 <code>Unsafe</code> 类会使得程序出错的概率变大，使得 Java 这种安全的语言变得不再“安全”，因此对 <code>Unsafe</code> 的使用一定要慎重。——节选：<a target="_blank" rel="noopener" href="https://javaguide.cn/java/basis/unsafe.html#unsafe-%E4%BB%8B%E7%BB%8D">Java 魔法类 Unsafe 详解 | JavaGuide</a></p>
<p>这个类正好提供了修改类的Class对象的module。</p>
<p>Unsafe存在<code>defineClass</code>和<code>defineAnonymousClass</code>不过在jdk17之后都被删除了。就不讨论了，和<code>ClassLoader#defineclass</code>功能一样。</p>
<p>我们关注下面这些方法：</p>
<p><strong>objectFieldOffset</strong></p>
<p>主要功能是使用反射来获取字段的偏移量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">objectFieldOffset</span><span class="params">(Field f)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (f == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    Class&lt;?&gt; declaringClass = f.getDeclaringClass();</span><br><span class="line">    <span class="keyword">if</span> (declaringClass.isHidden()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;can&#x27;t get field offset on a hidden class: &quot;</span> + f);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (declaringClass.isRecord()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;can&#x27;t get field offset on a record class: &quot;</span> + f);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> theInternalUnsafe.objectFieldOffset(f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>getAndSetObject</strong></p>
<p>获取一个对象在特定内存偏移量上的当前值，并将其替换为一个新值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">getAndSetObject</span><span class="params">(Object o, <span class="type">long</span> offset, Object newValue)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> theInternalUnsafe.getAndSetReference(o, offset, newValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>putObject</strong></p>
<p>用于将一个对象（或引用）写入到指定对象的内存偏移量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object o, <span class="type">long</span> offset, Object x)</span> &#123;</span><br><span class="line">    theInternalUnsafe.putReference(o, offset, x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>putObject和getAndSetObject方法功能很相似，不过<code>getAndSetObject</code>会返回被替换的旧值，当然里面细节也有所不同，比如<code>getAndSetObject</code>会使用原子操作保障同时执行读取和写入。不过就我们修改类的Class对象的moudle属性来说，两者都可以。</p>
<blockquote>
<p>我一直在说类的Class对象的module，也就是说module这个属性是在Class类里面的，当类加载到虚拟机的时候，会生成该类的Class对象，并且其有且仅有一个存在。</p>
</blockquote>
<p>获取一个Unsafe对象可以用下面代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">unsafeClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.misc.Unsafe&quot;</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> unsafeClass.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) field.get(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>可以直接反射获得该类，因为Unsafe类所在的模块<code>jdk.unsupported</code>的<code>moudle-info.class</code>文件中，使用了opens指令开放了<code>sun.misc</code>包，因为我们可以对该包下面的类进行反射操作，自然也包括<code>sun.misc.Unsafe</code></p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20241028025725610.png" alt="image-20241028025725610"></p>
<p>那么我们来用上面的知识来编写jdk17以上版本的动态加载字节码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKbypass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">evilClassBase64</span> <span class="operator">=</span> <span class="string">&quot;Base64 encoding of malicious bytecode&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.getDecoder().decode(evilClassBase64);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">unsafeClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.misc.Unsafe&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> unsafeClass.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) field.get(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Module</span> <span class="variable">baseModule</span> <span class="operator">=</span> Object.class.getModule();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">currentClass</span> <span class="operator">=</span> JDKbypass.class;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> unsafe.objectFieldOffset(Class.class.getDeclaredField(<span class="string">&quot;module&quot;</span>));</span><br><span class="line">        <span class="comment">//使用putObject方法来设置moudle</span></span><br><span class="line">        unsafe.putObject(currentClass, offset, baseModule);</span><br><span class="line">        <span class="comment">//使用getAndSetObject方法来设置moudle</span></span><br><span class="line">		<span class="comment">//unsafe.getAndSetObject(currentClass,offset,baseModule);</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass&quot;</span>, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ((Class) method.invoke(ClassLoader.getSystemClassLoader(), bytes, <span class="number">0</span>, bytes.length)).newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">高版本JDK加载字节码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JDK9%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">JDK9的模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">影响</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDK17%E7%9A%84%E5%BC%BA%E5%B0%81%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">JDK17的强封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsafe%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">Unsafe类</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&text=高版本JDK加载字节码分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&is_video=false&description=高版本JDK加载字节码分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=高版本JDK加载字节码分析&body=Check out this article: http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&title=高版本JDK加载字节码分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&name=高版本JDK加载字节码分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/10/28/%E9%AB%98%E7%89%88%E6%9C%ACJDK%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%86%E6%9E%90/&t=高版本JDK加载字节码分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2016-2025
        John Doe
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">首页</a></li><!--
        --><!--
          --><li><a href="/about/">关于</a></li><!--
        --><!--
          --><li><a href="/archives/">归档</a></li><!--
        --><!--
          --><li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li><!--
        -->
          </ul>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
      
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
